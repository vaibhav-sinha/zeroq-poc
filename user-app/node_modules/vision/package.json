{
  "name": "vision",
  "description": "Templates rendering plugin support for hapi.js",
  "version": "3.0.0",
  "repository": {
    "type": "git",
    "url": "git://github.com/hapijs/vision"
  },
  "main": "lib/index.js",
  "keywords": [
    "view",
    "render",
    "template",
    "hapi"
  ],
  "engines": {
    "node": ">=0.10.32"
  },
  "dependencies": {
    "boom": "2.x.x",
    "hoek": "^2.9.x",
    "items": "^1.1.x",
    "joi": "6.x.x"
  },
  "devDependencies": {
    "code": "1.x.x",
    "ejs": "2.x.x",
    "handlebars": "3.x.x",
    "hapi": "9.x.x",
    "jade": "1.x.x",
    "lab": "5.x.x",
    "mustache": "2.x.x",
    "nunjucks": "1.x.x",
    "hapi-react-views": "3.x.x",
    "react": "0.x.x"
  },
  "scripts": {
    "test": "lab -a code -t 100 -L",
    "test-cov-html": "lab -a code -r html -o coverage.html"
  },
  "license": "BSD-3-Clause",
  "readme": "#vision\n\nTemplates rendering plugin support for hapi.js.\n\n[![Build Status](https://secure.travis-ci.org/hapijs/vision.png)](http://travis-ci.org/hapijs/vision)\n\nLead Maintainer - [Jeffrey Jagoda](https://github.com/jagoda)\n\n**vision** decorates the [server](https://github.com/hapijs/hapi/blob/master/API.md#server) and\n[reply](https://github.com/hapijs/hapi/blob/master/API.md#reply-interface) interfaces with additional\nmethods for managing view engines that can be used to render templated responses. **vision** also\nprovides a built-in [handler](https://github.com/hapijs/hapi/blob/master/API.md#serverhandlername-method)\nimplementation for creating templated responses.\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8080 });\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        console.log(\"Failed to load vision.\");\n    }\n});\n```\n**NOTE:** Vision is included with and loaded by default in Hapi < 9.0.\n\n- [Examples](#examples)\n    - [EJS](#ejs)\n    - [Handlebars](#handlebars)\n    - [Jade](#jade)\n    - [Mustache](#mustache)\n    - [Nunjucks](#nunjucks)\n- [Usage](#usage)\n    - [`server.views(options)`](#serverviewsoptions)\n    - [`server.render(template, context, [options], callback)`](#serverrendertemplate-context-options-callback)\n    - [`reply.view(template, [context, [options]])`](#replyviewtemplate-context-options)\n    - [The `view` handler](#the-view-handler)\n\n## Examples\n\n**vision** is compatible with most major templating engines out of the box. Engines that don't follow\nthe normal API pattern can still be used by mapping their API to the **vision** API. Working code for\nthe following examples can be found in the [examples directory](./examples).\n\n### EJS\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8000 });\n\nvar rootHandler = function (request, reply) {\n\n    reply.view('index', {\n        title: 'examples/views/ejs/index.js | Hapi ' + request.server.version,\n        message: 'Index - Hello World!'\n    });\n};\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        throw err;\n    }\n\n    server.views({\n        engines: { ejs: require('ejs') },\n        relativeTo: __dirname,\n        path: 'templates'\n    });\n\n    server.route({ method: 'GET', path: '/', handler: rootHandler });\n});\n```\n\n### Handlebars\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8000 });\n\nvar handler = function (request, reply) {\n\n    reply.view('basic/index', {\n        title: 'examples/views/handlebars/basic.js | Hapi ' + request.server.version,\n        message: 'Hello World!'\n    });\n};\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        throw err;\n    }\n\n    server.views({\n        engines: { html: require('handlebars') },\n        path: __dirname + '/templates'\n    });\n\n    server.route({ method: 'GET', path: '/', handler: handler });\n});\n```\n\n### Jade\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8000 });\n\nvar rootHandler = function (request, reply) {\n\n    reply.view('index', {\n        title: 'examples/views/jade/index.js | Hapi ' + request.server.version,\n        message: 'Index - Hello World!'\n    });\n};\n\nvar aboutHandler = function (request, reply) {\n\n    reply.view('about', {\n        title: 'examples/views/jade/index.js | Hapi ' + request.server.version,\n        message: 'About - Hello World!'\n    });\n};\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        throw err;\n    }\n\n    server.views({\n        engines: { jade: require('jade') },\n        path: __dirname + '/templates',\n        compileOptions: {\n            pretty: true\n        }\n    });\n\n    server.route({ method: 'GET', path: '/', handler: rootHandler });\n    server.route({ method: 'GET', path: '/about', handler: aboutHandler });\n});\n```\n\n### Mustache\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8000 });\n\nvar rootHandler = function (request, reply) {\n\n    reply.view('index', {\n        title: 'examples/views/mustache/index.js | Hapi ' + request.server.version,\n        message: 'Index - Hello World!'\n    });\n};\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        throw err;\n    }\n\n    server.views({\n        engines: {\n            html: {\n                compile: function (template) {\n\n                    Mustache.parse(template);\n\n                    return function (context) {\n\n                        return Mustache.render(template, context);\n                    };\n                }\n            }\n        },\n        relativeTo: __dirname,\n        path: 'templates'\n    });\n\n    server.route({ method: 'GET', path: '/', handler: rootHandler });\n});\n```\n\n### Nunjucks\n\n```js\nvar server = new Hapi.Server();\nserver.connection({ port: 8000 });\n\nvar rootHandler = function (request, reply) {\n\n    reply.view('index', {\n        title: 'examples/views/nunjucks/index.js | Hapi ' + request.server.version,\n        message: 'Index - Hello World!'\n    });\n};\n\nserver.register(require('vision'), function (err) {\n\n    if (err) {\n        throw err;\n    }\n\n    server.views({\n        engines: {\n            html: {\n                compile: function (src, options) {\n\n                    var template = Nunjucks.compile(src, options.environment);\n\n                    return function (context) {\n\n                        return template.render(context);\n                    };\n                },\n\n                prepare: function (options, next) {\n\n                    options.compileOptions.environment = Nunjucks.configure(options.path, { watch : false });\n                    return next();\n                }\n            }\n        },\n        path: Path.join(__dirname, 'templates')\n    });\n\n    server.route({ method: 'GET', path: '/', handler: rootHandler });\n});\n```\n\n## Usage\n\nMost interaction with **vision** is done via the [server](https://github.com/hapijs/hapi/blob/master/API.md#server)\nand [reply](https://github.com/hapijs/hapi/blob/master/API.md#reply-interface) interfaces. When the\n**vision** plugin is registered, the base [Hapi APIs](https://github.com/hapijs/hapi/blob/master/API.md)\nare augmented with the following:\n\n### `server.views(options)`\n\nInitializes the server views manager where:\n- `options` - a configuration object with the following:\n    - `engines` - required object where each key is a file extension (e.g. 'html', 'hbr'), mapped\n      to the npm module used for rendering the templates. Alternatively, the extension can be\n      mapped to an object with the following options:\n        - `module` - the npm module used for rendering the templates. The module object must\n          contain the `compile()` function:\n            - `compile()` - the rendering function. The required function signature depends on the\n              `compileMode` settings. If the `compileMode` is `'sync'`, the signature is\n              `compile(template, options)`, the return value is a function with signature\n              `function(context, options)`, and the method is allowed to throw errors. If the\n              `compileMode` is `'async'`, the signature is `compile(template, options, callback)`\n              where `callback` has the signature `function(err, compiled)` where `compiled` is a\n              function with signature `function(context, options, callback)` and `callback` has the\n              signature `function(err, rendered)`.\n            - `prepare(config, next)` - initializes additional engine state.\n              The `config` object is the engine configuration object allowing updates to be made.\n              This is useful for engines like Nunjucks that rely on additional state for rendering.\n              `next` has the signature `function(err)`.\n            - `registerPartial(name, src)` - registers a partial for use during template rendering.\n              The `name` is the partial path that templates should use to reference the partial and\n              `src` is the uncompiled template string for the partial.\n            - `registerHelper(name, helper)` - registers a helper for use during template rendering.\n              The `name` is the name that templates should use to reference the helper and `helper`\n              is the function that will be invoked when the helper is called.\n        - any of the `views` options listed below (except `defaultExtension`) to override the\n          defaults for a specific engine.\n    - `defaultExtension` - defines the default filename extension to append to template names when\n      multiple engines are configured and not explicit extension is provided for a given template.\n      No default value.\n    - `path` - the root file path used to resolve and load the templates identified when calling\n      [`reply.view()`](https://github.com/hapijs/hapi/blob/master/API.md#replyviewtemplate-context-options).\n      Defaults to current working directory.\n    - `partialsPath` - the root file path where partials are located. Partials are small segments\n      of template code that can be nested and reused throughout other templates. Defaults to no\n      partials support (empty path).\n    - `helpersPath` - the directory path where helpers are located. Helpers are functions used\n      within templates to perform transformations and other data manipulations using the template\n      context or other inputs. Each '.js' file in the helpers directory is loaded and the file name\n      is used as the helper name. The files must export a single method with the signature\n      `function(context)` and return a string. Sub-folders are not supported and are ignored.\n      Defaults to no helpers support (empty path). Note that jade does not support loading helpers\n      this way.\n    - `relativeTo` - a base path used as prefix for `path` and `partialsPath`. No default.\n    - `layout` - if set to `true` or a layout filename, layout support is enabled. A layout is a\n      single template file used as the parent template for other view templates in the same engine.\n      If `true`, the layout template name must be 'layout.ext' where 'ext' is the engine's\n      extension. Otherwise, the provided filename is suffixed with the engine's extension and\n      loaded. Disable `layout` when using Jade as it will handle including any layout files\n      independently. Defaults to `false`.\n    - `layoutPath` - the root file path where layout templates are located (using the `relativeTo`\n      prefix if present). Defaults to `path`.\n    - `layoutKeyword` - the key used by the template engine to denote where primary template\n      content should go. Defaults to `'content'`.\n    - `encoding` - the text encoding used by the templates when reading the files and outputting\n      the result. Defaults to `'utf8'`.\n    - `isCached` - if set to `false`, templates will not be cached (thus will be read from file on\n      every use). Defaults to `true`.\n    - `allowAbsolutePaths` - if set to `true`, allows absolute template paths passed to\n      [`reply.view()`](https://github.com/hapijs/hapi/blob/master/API.md#replyviewtemplate-context-options).\n      Defaults to `false`.\n    - `allowInsecureAccess` - if set to `true`, allows template paths passed to\n      [`reply.view()`](https://github.com/hapijs/hapi/blob/master/API.md#replyviewtemplate-context-options)\n      to contain '../'. Defaults to `false`.\n    - `compileOptions` - options object passed to the engine's compile function. Defaults to empty\n      options `{}`.\n    - `runtimeOptions` - options object passed to the returned function from the compile operation.\n      Defaults to empty options `{}`.\n    - `contentType` - the content type of the engine results. Defaults to `'text/html'`.\n    - `compileMode` - specify whether the engine `compile()` method is `'sync'` or `'async'`.\n      Defaults to `'sync'`.\n    - `context` - a global context used with all templates. The global context option can be either\n      an object or a function that takes no arguments and returns a context object. When rendering\n      views, the global context will be merged with any context object specified on the handler or\n      using [`reply.view()`](https://github.com/hapijs/hapi/blob/master/API.md#replyviewtemplate-context-options).\n      When multiple context objects are used, values from the global context always have lowest precedence.\n\nWhen [`server.views()`](https://github.com/hapijs/hapi/blob/master/API.md#serverviewsoptions) is called within a\nplugin, the views manager is only available to [plugins](https://github.com/hapijs/hapi/blob/master/API.md#plugins)\nmethods.\n\n### `server.render(template, context, [options], callback)`\n\nUtilizes the server views manager to render a template where:\n- `template` - the template filename and path, relative to the views manager templates path (`path`\n  or `relativeTo`).\n- `context` - optional object used by the template to render context-specific result. Defaults to\n  no context (`{}`).\n- `options` - optional object used to override the views manager configuration.\n- `callback` - the callback function with signature `function (err, rendered, config)` where:\n    - `err` - the rendering error if any.\n    - `rendered` - the result view string.\n    - `config` - the configuration used to render the template.\n\n```js\nvar Hapi = require('hapi');\nvar server = new Hapi.Server();\nserver.connection({ port: 80 });\nserver.views({\n    engines: { html: require('handlebars') },\n    path: __dirname + '/templates'\n});\n\nvar context = {\n    title: 'Views Example',\n    message: 'Hello, World'\n};\n\nserver.render('hello', context, function (err, rendered, config) {\n\n    console.log(rendered);\n});\n```\n\n### `reply.view(template, [context, [options]])`\n\nConcludes the handler activity by returning control over to the router with a templatized view\nresponse where:\n\n- `template` - the template filename and path, relative to the templates path configured via the\n  server views manager.\n- `context` - optional object used by the template to render context-specific result. Defaults to\n  no context `{}`.\n- `options` - optional object used to override the server's views manager configuration for this\n  response. Cannot override `isCached`, `partialsPath`, or `helpersPath` which are only loaded at\n  initialization.\n\nReturns a [response object](https://github.com/hapijs/hapi/blob/master/API.md#response-object).\n\nThe [response flow control rules](https://github.com/hapijs/hapi/blob/master/API.md#flow-control) apply.\n\n```js\nvar Hapi = require('hapi');\nvar server = new Hapi.Server();\nserver.connection({ port: 80 });\nserver.views({\n    engines: { html: require('handlebars') },\n    path: __dirname + '/templates'\n});\n\nvar handler = function (request, reply) {\n\n    var context = {\n        title: 'Views Example',\n        message: 'Hello, World'\n    };\n\n    return reply.view('hello', context);\n};\n\nserver.route({ method: 'GET', path: '/', handler: handler });\n```\n\n**templates/hello.html**\n\n```html\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>{{title}}</title>\n    </head>\n    <body>\n        <div>\n            <h1>{{message}}</h1>\n        </div>\n    </body>\n</html>\n```\n\n### The `view` handler\n\nThe `view` handler can be used with routes registered in the same realm as the view manager. The\nhandler takes an `options` parameter that can be either a string or an object. When the `options`\nparameter is a string, it should be the filename and path of the template relative to the templates\npath configured via the views manager. When the `options` parameter is an object, it may have the\nfollowing keys:\n\n- `template` - the template filename and path, relative to the templates path configured via the\n  server views manager.\n- `context` - optional object used by the template to render context-specific result. Defaults to\n  no context `{}`.\n- `options` - optional object used to override the server's views manager configuration for this\n  response. Cannot override `isCached`, `partialsPath`, or `helpersPath` which are only loaded at\n  initialization.\n\nThe rendering `context` contains the `params`, `payload`, `query`, and `pre` values from the\n[request](https://github.com/hapijs/hapi/blob/master/API.md#request-properties) by default (these\ncan be overriden by values explicitly set via the `options`).\n\n```js\nvar Hapi = require('hapi');\nvar server = new Hapi.Server();\nserver.connection({ port: 80 });\nserver.views({\n    engines: { html: require('handlebars') },\n    path: __dirname + '/templates'\n});\n\nserver.route({\n    method: 'GET',\n    path: '/',\n    handler: {\n        view: {\n            template: 'hello',\n            context: {\n                title: 'Views Example',\n                message: 'Hello, World'\n            }\n        }\n    }\n});\n```\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/hapijs/vision/issues"
  },
  "_id": "vision@3.0.0",
  "_from": "vision@>=3.x.x"
}
